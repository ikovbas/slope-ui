/**
 * angular-strap
 * @version v2.0.4 - 2014-08-04
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("mgcrea.ngStrap.typeahead",["mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.parseOptions"]).provider("$typeahead",function(){var e=this.defaults={animation:"am-fade",prefixClass:"typeahead",prefixEvent:"$typeahead",placement:"bottom-left",template:"typeahead/typeahead.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,minLength:1,filter:"filter",limit:6};this.$get=["$window","$rootScope","$tooltip","$parse",function(t,n,a,i){function o(t,n,o){var l={},r=angular.extend({},e,o);l=a(t,r);var s=o.scope,c=l.$scope;c.$selectedValue=null,c.$resetMatches=function(){c.$matches=[],c.$activeIndex=0},c.$resetMatches(),c.$activate=function(e){c.$$postDigest(function(){l.activate(e)})},c.$select=function(e){c.$$postDigest(function(){l.select(e)})},c.$isVisible=function(){return l.$isVisible()},l.update=function(e){c.$matches=e,c.$activeIndex>=e.length&&(c.$activeIndex=0)},l.activate=function(e){c.$activeIndex=e},l.select=function(e){if(c.$selectedValue=c.$matches[e].value,n.$setViewValue(c.$selectedValue),n.$render(),c.$resetMatches(),s&&s.$digest(),c.$emit(r.prefixEvent+".select",c.$selectedValue,e),r.onSelect){var t=i(r.onSelect);"function"==typeof t&&t(c)}},l.$isVisible=function(){if(!r.minLength||!n)return!!c.$matches.length;var e=angular.isString(n.$viewValue)&&n.$viewValue.length>=r.minLength;return c.$matches.length&&(e||0===parseInt(r.minLength))},l.$getIndex=function(e){var t=c.$matches.length,n=t;if(t){for(n=t;n--&&c.$matches[n].value!==e;);if(!(0>n))return n}},l.$onMouseDown=function(e){e.preventDefault(),e.stopPropagation()},l.$onKeyDown=function(e){/(^38$|^40$|^13$|^9$)/.test(e.keyCode)&&(l.$isVisible()&&(e.preventDefault(),e.stopPropagation()),13===e.keyCode||9===e.keyCode?c.$matches.length&&l.select(c.$activeIndex):38===e.keyCode&&c.$activeIndex>0?c.$activeIndex--:40===e.keyCode&&c.$activeIndex<c.$matches.length-1?c.$activeIndex++:angular.isUndefined(c.$activeIndex)&&(c.$activeIndex=0),9!==e.keyCode&&e.preventDefault(),9!==e.keyCode&&e.stopPropagation(),c.$digest())};var u=l.show;l.show=function(){u(),setTimeout(function(){l.$element.on("mousedown",l.$onMouseDown),r.keyboard&&t.on("keydown",l.$onKeyDown)})};var $=l.hide;return l.hide=function(){l.$element.off("mousedown",l.$onMouseDown),r.keyboard&&t.off("keydown",l.$onKeyDown),$()},l}angular.element(t.document.body);return o.defaults=e,o}]}).directive("bsTypeahead",["$window","$parse","$q","$typeahead","$parseOptions",function(e,t,n,a,i){var o=a.defaults;return{restrict:"EAC",require:"ngModel",link:function(e,n,l,r){var s={scope:e};angular.forEach(["placement","container","delay","trigger","keyboard","html","animation","template","filter","limit","minLength","watchOptions","selectMode","onSelect","inputLabel"],function(e){angular.isDefined(l[e])&&(s[e]=l[e])});var c=s.filter||o.filter,u=s.limit||o.limit,$=l.ngOptions;c&&($+=" | "+c+":$viewValue"),u&&($+=" | limitTo:"+u);var d=i($),f=a(n,r,s);if(s.watchOptions){var p=d.$match[7].replace(/\|.+/,"").replace(/\(.*\)/g,"").trim();e.$watch(p,function(){d.valuesFn(e,r).then(function(e){f.update(e),r.$render()})},!0)}e.$watch(l.ngModel,function(t){e.$modelValue=t,d.valuesFn(e,r).then(function(e){if(s.selectMode&&!e.length&&t.length>0)return void r.$setViewValue(r.$viewValue.substring(0,r.$viewValue.length-1));e.length>u&&(e=e.slice(0,u));var n=f.$isVisible();n&&f.update(e),t!==f.$scope.$selectedValue&&(!n&&f.update(e),r.$render())})}),r.$render=function(){if(r.$isEmpty(r.$viewValue))return n.val("");var a=f.$getIndex(r.$modelValue),i="";if(s.inputLabel){var o=t(s.inputLabel);i=o(e)}else i=angular.isNumber(a)?f.$scope.$matches[a].label:r.$viewValue,angular.isObject(i)&&(i=i.label);angular.isString(i)&&(r.$viewValue=i.replace(/<(?:.|\n)*?>/gm,"").trim(),n.val(r.$viewValue))},e.$on("$destroy",function(){f.destroy(),s=null,f=null})}}}]);
//# sourceMappingURL=typeahead.min.js.map